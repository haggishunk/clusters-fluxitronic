---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kube-prometheus-stack
spec:
  values:
    defaultRules:
      additionalRuleLabels:
        cluster: doks-dev
      ingress:
        hosts:
        - alertmanager.mattera.io
      alertmanagerSpec:
        externalUrl: https://alertmanager.mattera.io
        storage:
          volumeClaimTemplate:
            spec:
              storageClassName: do-block-storage
    alertmanager:
      serviceMonitor:
        metricRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
    grafana:
      serviceMonitor:
        metricRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
    kubelet:
      serviceMonitor:
        metricRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
        cAdvisorMetricsRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
        probesMetricsRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
        resourceMetricsRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
    coreDns:
      serviceMonitor:
        metricRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
    kube-state-metrics:
      prometheus:
        monitor:
          metricRelabelings:
          - targetLabel: cluster
            replacement: doks-dev
            sourceLabels: [__name__]
    prometheus-node-exporter:
      prometheus:
        monitor:
          metricRelabelings:
          - targetLabel: cluster
            replacement: doks-dev
            sourceLabels: [__name__]
    prometheusOperator:
      serviceMonitor:
        metricRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
    prometheus:
      serviceMonitor:
        metricRelabelings:
        - targetLabel: cluster
          replacement: doks-dev
          sourceLabels: [__name__]
      ingress:
        hosts:
        - prometheus.mattera.io
      prometheusSpec:
        externalUrl: https://prometheus.mattera.io
        storageSpec:
          volumeClaimTemplate:
            spec:
              storageClassName: do-block-storage
