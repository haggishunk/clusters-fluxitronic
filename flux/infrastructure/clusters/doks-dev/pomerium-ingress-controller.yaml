---
apiVersion: v1
kind: Namespace
metadata:
  name: pomerium
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: pomerium-ingress-controller
  namespace: pomerium
spec:
  targetNamespace: pomerium
  interval: 10m
  sourceRef:
    kind: GitRepository
    name: pomerium-ingress-controller
    namespace: flux-system
  path: compose/mattera-io
  include:
  - repository:
      name: pomerium-ingress-controller
    fromPath: config/config
    toPath: compose/mattera-io/config
  - repository:
      name: pomerium-ingress-controller
    fromPath: config/prometheus
    toPath: compose/mattera-io/prometheus
  prune: true
  patches:
  - patch: |
      - op: add
        path: /metadata/annotations/external-dns.alpha.kubernetes.io~1hostname
        value: ingress.mattera.io
    target:
      kind: Service
      name: pomerium-proxy
